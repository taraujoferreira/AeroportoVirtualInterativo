<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aeroporto VR ‚Äî Wayfinding</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <script>
      AFRAME.registerComponent("face-camera", {
        tick: function () {
          const cam = document.getElementById("cam");
          if (!cam) return;
          const camPos = cam.object3D.getWorldPosition(new THREE.Vector3());
          this.el.object3D.lookAt(camPos);
          this.el.object3D.rotation.x = 0;
          this.el.object3D.rotation.z = 0;
        },
      });

      AFRAME.registerComponent("wayfinding", {
        init: function () {
          // ESTADO INICIAL
          this.state = {
            targetGate: null,
            reached: false,
            securityPassed: false,
            baggageType: null,
            requiredItem: null, // "luggage" | "backpack"
          };

          this.el.sceneEl.addEventListener("loaded", () => {
            this.hudTarget = document.getElementById("hudTarget");
            this.cam = document.getElementById("cam");
            this.player = document.getElementById("player");
            this.wall = document.getElementById("securityWall");
            this.wallText = document.getElementById("securityWallText");
            this.successSound = document.getElementById("soundSuccess");


            this.gates = {
              A1: document.getElementById("gateA1"),
              A2: document.getElementById("gateA2"),
              A3: document.getElementById("gateA3"),
            };
            this.gateTargets = Array.from(document.querySelectorAll(".gateTarget"));

            // Configurar bot√µes dos Gates
            document.querySelectorAll(".gateBtn").forEach((btn) => {
              btn.addEventListener("click", () => {
                const gate = btn.getAttribute("data-gate");
                this.setTargetGate(gate);
              });
              btn.addEventListener("mouseenter", () => btn.object3D.scale.set(1.1, 1.1, 1.1));
              btn.addEventListener("mouseleave", () => btn.object3D.scale.set(1, 1, 1));
            });

            // Bot√µes de Bagagem
            document.querySelectorAll(".bagBtn").forEach((btn) => {
              btn.addEventListener("click", () => {
                const type = btn.getAttribute("data-bag"); // "hand" | "checked"
                this.setBaggageType(type);
              });

              btn.addEventListener("mouseenter", () => btn.object3D.scale.set(1.08, 1.08, 1.08));
              btn.addEventListener("mouseleave", () => btn.object3D.scale.set(1, 1, 1));
            });

            // Ao carregar, esconde tudo at√© escolher bagagem
            this.resetBaggageChoice();
          });
        },

        getCarrySys: function () {
          return this.el.sceneEl.components["carry-system"];
        },

        passSecurity: function(delayMs = 0) {
          if (this.state.securityPassed) return;

          const doPass = () => {
            if (this.state.securityPassed) return;
            this.state.securityPassed = true;

            if (this.successSound) this.successSound.components.sound.playSound();

            if (this.wall) this.wall.setAttribute("visible", "false");
            if (this.wallText) this.wallText.setAttribute("value", "");

            if (this.hudTarget) this.hudTarget.textContent = "‚úÖ Raio-X conclu√≠do! Podes seguir para o Gate.";
          };

          if (delayMs > 0) setTimeout(doPass, delayMs);
          else doPass();
        },


        resetSecurity: function () {
          this.state.securityPassed = false;

          if (this.wall) this.wall.setAttribute("visible", "true");
          if (this.wallText) this.wallText.setAttribute("value", "PARE!\nValide os seus pertences no raio-X.");

          // Se j√° houver escolha de bagagem, respawn do item obrigat√≥rio
          const carrySys = this.getCarrySys();
          if (carrySys && this.state.requiredItem) {
            carrySys.setActiveItem(this.state.requiredItem);
            carrySys.respawnActiveItem();
          }
        },

        resetBaggageChoice: function () {
          this.state.baggageType = null;
          this.state.requiredItem = null;

          const carrySys = this.getCarrySys();
          if (carrySys) carrySys.hideAllItems();
        },

        setBaggageType: function (type) {
          if (!this.state.targetGate) {
            if (this.hudTarget) this.hudTarget.textContent = "‚ö†Ô∏è Primeiro escolhe um Gate no CHECK-IN.";
            return;
          }

          this.state.baggageType = type;

          const carrySys = this.getCarrySys();
          if (!carrySys) return;

          if (type === "hand") {
            // M√£o ‚Üí valida a mala
            this.state.requiredItem = "luggage";
            carrySys.setActiveItem("luggage");
            carrySys.respawnActiveItem();

            if (this.hudTarget) {
              this.hudTarget.textContent =
                "üéí Bagagem de M√ÉO: pega na mala e larga no scanner (c√≠rculo verde) para validar.";
            }
            return;
          }

          if (type === "checked") {
            // Por√£o ‚Üí valida a mochila (pertences)
            this.state.requiredItem = "backpack";
            carrySys.setActiveItem("backpack");
            carrySys.respawnActiveItem();

            if (this.hudTarget) {
              this.hudTarget.textContent =
                "üß≥ Bagagem de POR√ÉO: pega na mochila (pertences) e larga no scanner (c√≠rculo verde) para validar.";
            }
          }
        },

        setTargetGate: function (gate) {
          const changed = this.state.targetGate !== gate;

          this.state.targetGate = gate;
          this.state.reached = false;

          if (changed) {
            // ao mudar de gate: reseta seguran√ßa + volta a pedir escolha de bagagem
            this.resetSecurity();
            this.resetBaggageChoice();
          }

          if (this.hudTarget) {
            this.hudTarget.textContent = `‚úÖ Gate ${gate} escolhido. Agora escolhe o tipo de bagagem (M√ÉO ou POR√ÉO).`;
          }

          const gateEl = this.gates?.[gate];
          if (!gateEl) return;

          const p = gateEl.object3D.getWorldPosition(new THREE.Vector3());

          const marker = document.getElementById("targetMarker");
          if (marker) {
            marker.setAttribute("position", `${p.x} 2.9 ${p.z}`);
            marker.setAttribute("visible", "true");
          }

          const arrow = document.getElementById("navArrow");
          if (arrow) arrow.setAttribute("visible", "true");
        },

        tick: function () {
          if (!this.cam) return;

          const camPos = this.cam.object3D.getWorldPosition(new THREE.Vector3());

          // BLOQUEIO DA SEGURAN√áA (kick)
          if (camPos.z < 2.5 && !this.state.securityPassed) {
            if (this.hudTarget) {
              this.hudTarget.textContent =
                "‚õî STOP! Coloca os teus pertences no scanner (c√≠rculo verde) para passar.";
            }

            const rig = document.getElementById("player");
            if (rig) {
              const offsetX = 0 - camPos.x;
              const offsetZ = 18 - camPos.z;

              rig.object3D.position.x += offsetX;
              rig.object3D.position.z += offsetZ;
            }
          }

          // Chegada ao Gate
          if (!this.state.targetGate || this.state.reached) return;
          if (!this.gateTargets) return;

          for (const t of this.gateTargets) {
            const gate = t.getAttribute("data-gate");
            if (gate !== this.state.targetGate) continue;

            const tPos = t.object3D.getWorldPosition(new THREE.Vector3());
            const dx = camPos.x - tPos.x;
            const dz = camPos.z - tPos.z;
            const d = Math.sqrt(dx * dx + dz * dz);

            if (d < 2.0) {
              this.state.reached = true;
              if (this.hudTarget) this.hudTarget.textContent = `‚úÖ Chegaste ao Gate ${gate}. V√™ o destino na esfera!`;
              if (this.successSound) this.successSound.components.sound.playSound();

              const marker = document.getElementById("targetMarker");
              const arrow = document.getElementById("navArrow");
              if (marker) marker.setAttribute("visible", "false");
              if (arrow) arrow.setAttribute("visible", "false");
            }
          }
        },
      });

      // Preview (igual)
      AFRAME.registerComponent("destination-preview", {
        init: function () {
          this.el.addEventListener("click", () => {
            const sky = document.getElementById("main-sky");
            const paris360 = "paris.jpg";

            if (sky) {
              sky.setAttribute("src", paris360);
              sky.setAttribute("color", "#FFF");
              const sound = document.getElementById("soundSuccess");
              if (sound) sound.components.sound.playSound();
              const hud = document.getElementById("hudTarget");
              if (hud) hud.textContent = "üóº Bem-vindo a Paris! (Olha em volta)";
            }
          });

          this.el.addEventListener("mouseenter", () => {
            this.el.setAttribute("scale", "1.2 1.2 1.2");
            this.el.setAttribute("material", "color: #e74c3c");
          });

          this.el.addEventListener("mouseleave", () => {
            this.el.setAttribute("scale", "1 1 1");
            this.el.setAttribute("material", "color: #3498db");
          });
        },
      });

      // Desbloqueia o √°udio no 1¬∫ input (Chrome/VR bloqueia autoplay)
      AFRAME.registerComponent("audio-unlock", {
        init: function () {
          const getCtx = () => {
            // A-Frame 1.5 / three.js: contexto de √°udio recomendado
            if (window.THREE?.AudioContext?.getContext) return THREE.AudioContext.getContext();
            // fallback (caso raro)
            return AFRAME.audioContext || null;
          };

          const forcePlayWhenReady = () => {
            // for√ßa o ambiente a tocar, mas s√≥ quando estiver carregado
            const ambienceEl = document.getElementById("ambience");
            if (!ambienceEl || !ambienceEl.components?.sound) return;

            // se j√° estiver carregado, toca j√°
            if (ambienceEl.components.sound.isPlaying) return;
            ambienceEl.components.sound.playSound();
          };

          const unlock = async () => {
            try {
              const ctx = getCtx();
              if (ctx && ctx.state !== "running") await ctx.resume();

              console.log("[audio] unlocked ‚úÖ state:", getCtx()?.state);

              // tenta tocar j√° (se n√£o estiver carregado, vai avisar)
              forcePlayWhenReady();
            } catch (e) {
              console.warn("[audio] unlock falhou:", e);
            }

            window.removeEventListener("click", unlock);
            window.removeEventListener("keydown", unlock);
            window.removeEventListener("touchstart", unlock);

            const canvas = this.el.sceneEl?.canvas;
            if (canvas) canvas.removeEventListener("click", unlock);
          };

          // garantir unlock via eventos comuns + click no canvas
          window.addEventListener("click", unlock);
          window.addEventListener("keydown", unlock);
          window.addEventListener("touchstart", unlock);

          this.el.sceneEl.addEventListener("renderstart", () => {
            const canvas = this.el.sceneEl.canvas;
            if (canvas) canvas.addEventListener("click", unlock);
          });

          // quando o som estiver carregado, toca (resolve o warn)
          this.el.sceneEl.addEventListener("loaded", () => {
            const ambienceEl = document.getElementById("ambience");
            if (!ambienceEl) return;

            ambienceEl.addEventListener("sound-loaded", () => {
              // se j√° desbloqueaste, isto vai tocar logo
              forcePlayWhenReady();
            });
          });
        },
      });



      // =====================================================
      // Carry System (mala + mochila) ‚Äî valida sempre no scanner
      // =====================================================
      AFRAME.registerComponent("carry-system", {
        init: function () {
          this.held = false;
          this.activeItemId = null; // "luggage" | "backpack"
          this.heldItemId = null;

          this.holdingOffset = { x: 0.9, y: -0.6, z: -0.9 };

          this.el.sceneEl.addEventListener("loaded", () => {
            this.wf = this.el.sceneEl.components.wayfinding;

            this.cam = document.getElementById("cam");
            this.hudTarget = document.getElementById("hudTarget");
            this.dropzone = document.getElementById("securityDropzone");

            this.items = {
              luggage: document.getElementById("luggage"),
              backpack: document.getElementById("backpack"),
            };

            // Guardar spawn de ambos
            this.spawn = {};
            Object.entries(this.items).forEach(([id, el]) => {
              if (!el) return;
              const p = el.getAttribute("position");
              const r = el.getAttribute("rotation") || { x: 0, y: 0, z: 0 };
              this.spawn[id] = { pos: { ...p }, rot: { ...r } };

              el.addEventListener("click", () => this.onItemClick(id));
            });

            // tecla E para largar
            window.addEventListener("keydown", (e) => {
              if (e.key.toLowerCase() === "e" && this.held) this.drop();
            });

            // por defeito: esconde tudo
            this.hideAllItems();
          });
        },

        hideAllItems: function () {
          Object.values(this.items).forEach((el) => {
            if (el) el.setAttribute("visible", "false");
          });
          this.activeItemId = null;
          this.held = false;
          this.heldItemId = null;
        },

        setActiveItem: function (id) {
          this.activeItemId = id;

          Object.entries(this.items).forEach(([key, el]) => {
            if (!el) return;
            el.setAttribute("visible", key === id ? "true" : "false");
          });

          // se estava a segurar algo, solta estado (seguran√ßa)
          this.held = false;
          this.heldItemId = null;
        },

        respawnActiveItem: function () {
          const id = this.activeItemId;
          const el = id ? this.items[id] : null;
          if (!el || !this.spawn[id]) return;

          this.held = false;
          this.heldItemId = null;

          if (el.object3D.parent) el.object3D.parent.remove(el.object3D);
          this.el.sceneEl.object3D.add(el.object3D);

          el.setAttribute("position", `${this.spawn[id].pos.x} ${this.spawn[id].pos.y} ${this.spawn[id].pos.z}`);
          el.setAttribute("rotation", `${this.spawn[id].rot.x} ${this.spawn[id].rot.y} ${this.spawn[id].rot.z}`);
          el.setAttribute("visible", "true");
        },

        onItemClick: function (id) {
          // bloqueios do fluxo
          if (this.wf && this.wf.state) {
            if (!this.wf.state.targetGate) {
              if (this.hudTarget) this.hudTarget.textContent = "‚ö†Ô∏è Faz CHECK-IN e escolhe um Gate primeiro.";
              return;
            }
            if (!this.wf.state.baggageType) {
              if (this.hudTarget) this.hudTarget.textContent = "‚ö†Ô∏è Escolhe o tipo de bagagem (M√ÉO ou POR√ÉO).";
              return;
            }
            if (this.wf.state.requiredItem && this.wf.state.requiredItem !== id) {
              if (this.hudTarget) this.hudTarget.textContent = "‚ÑπÔ∏è Esse n√£o √© o item que tens de validar agora.";
              return;
            }
          }

          if (!this.held) this.pickUp(id);
          else this.drop();
        },

        pickUp: function (id) {
          const el = this.items[id];
          if (!this.cam || !el) return;

          this.held = true;
          this.heldItemId = id;

          if (el.object3D.parent) el.object3D.parent.remove(el.object3D);
          this.cam.object3D.add(el.object3D);

          el.object3D.position.set(this.holdingOffset.x, this.holdingOffset.y, this.holdingOffset.z);
          el.object3D.rotation.set(0, 0, 0);

          if (this.hudTarget) this.hudTarget.textContent = "üì¶ Leva o item ao scanner (c√≠rculo verde) e larga (E ou click).";
        },

        drop: function () {
          const id = this.heldItemId;
          const el = id ? this.items[id] : null;
          if (!this.cam || !el) return;

          const worldPos = new THREE.Vector3();
          el.object3D.getWorldPosition(worldPos);

          this.cam.object3D.remove(el.object3D);
          this.el.sceneEl.object3D.add(el.object3D);

          // encostar ao ch√£o (se precisares: ajusta este Y)
          el.object3D.position.set(worldPos.x, 0, worldPos.z);

          this.held = false;
          this.heldItemId = null;

          // üîß MUITO IMPORTANTE: for√ßa atualiza√ß√£o de world matrices no mesmo frame
          el.object3D.updateMatrixWorld(true);
          if (this.dropzone) this.dropzone.object3D.updateMatrixWorld(true);
          if (this.isOnDropzone(el)) {
            this.snapToDropzoneAndValidate(el);
          } else {
            if (this.hudTarget) this.hudTarget.textContent = "üì¶ Largaste o item. (Dica: larga no c√≠rculo verde.)";
          }
        },

        isOnDropzone: function (el) {
          if (!this.dropzone || !el) return false;

          const dz = new THREE.Vector3();
          const lp = new THREE.Vector3();

          this.dropzone.object3D.getWorldPosition(dz);
          el.object3D.getWorldPosition(lp);

          const dx = dz.x - lp.x;
          const dzv = dz.z - lp.z;
          const d = Math.sqrt(dx * dx + dzv * dzv);

          return d < 1.35;
        },

        snapToDropzoneAndValidate: function (el) {
          if (!this.dropzone || !el) return;

          const dz = this.dropzone.getAttribute("position");
          el.setAttribute("position", `${dz.x} ${dz.y + 0.25} ${dz.z}`);

          // j√° validado? n√£o repete
          if (this.wf && this.wf.state && this.wf.state.securityPassed) return;

          // HUD: scanning
          if (this.hudTarget) this.hudTarget.textContent = "üîé A analisar no raio-X...";

          // SFX real do scanner
          const sfx = document.getElementById("scannerSfxEntity")?.components?.sound;
          if (sfx) {
            sfx.stopSound();
            sfx.playSound();
}




          // valida 1 segundo depois
          if (this.wf) this.wf.passSecurity(1000);
        },
      });
    </script>


    <style>
      html, body { margin: 0; height: 100%; overflow: hidden; }
      #hud {
        position: fixed; left: 12px; top: 12px; z-index: 10;
        background: rgba(0,0,0,.6); color: #fff; padding: 10px 12px;
        border-radius: 12px; font-family: system-ui, sans-serif; font-size: 14px;
      }
    </style>
  </head>

  <body>
    <div id="hud">
      <b>Aeroporto VR</b><br />WASD ‚Ä¢ Rato
      <br/><span id="hudTarget">Entra no aeroporto e faz Check-in.</span>
    </div>

    <a-scene wayfinding carry-system audio-unlock
         renderer="colorManagement: true; physicallyCorrectLights: true;"
         shadow="type: pcfsoft">
      <a-sky id="main-sky" color="#87CEEB"></a-sky>


      <a-assets>
        <img id="chao-tex" src="chao2.jpg">
        <img id="parede-tex" src="parede.jpg">
        <img id="asfalto-tex" src="https://cdn.aframe.io/a-painter/images/floor.jpg">

        <a-asset-item id="modelo-mala" src="luggage.glb"></a-asset-item>
        <a-asset-item id="modelo-backpack" src="backpack.glb"></a-asset-item>
        <a-asset-item id="modelo-balcao" src="airport_check_in_desk.glb"></a-asset-item>
        <a-asset-item id="modelo-security" src="airport_security_check.glb"></a-asset-item>

        <!-- NOVOS MODELOS -->
        <a-asset-item id="modelo-cadeira" src="waiting_chair.glb"></a-asset-item>
        <a-asset-item id="modelo-gate-sign" src="airport_boarding_gate_sign.glb"></a-asset-item>

        <audio id="airportAmbience"
       src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_3079b47e40.mp3"
       preload="auto"
       crossorigin="anonymous"></audio>

        <audio id="successClip"
              src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_0625c153e1.mp3"
              preload="auto"
              crossorigin="anonymous"></audio>

        <audio id="scannerSfx" src="scannerSound.wav" preload="auto"></audio>

      </a-assets>

      

      <a-entity id="ambience" sound="src: #airportAmbience; autoplay: true; loop: true; volume: 0.5"></a-entity>

      <a-entity id="soundSuccess" sound="src: #successClip; volume: 1.0; poolSize: 5"></a-entity>

      <a-entity light="type: directional; castShadow: true; intensity: 1.5; shadowCameraVisible: false;"
                position="-20 50 -20" target="#directionaltarget">
        <a-entity id="directionaltarget" position="0 0 0"></a-entity>
      </a-entity>
      <a-entity light="type: ambient; intensity: 0.6; color: #fff"></a-entity>

      <a-entity id="player" position="0 0 25">
        <a-camera id="cam" position="0 1.6 0"
                  wasd-controls="acceleration: 50"
                  look-controls="pointerLockEnabled: true; mouseSensitivity: 0.06">
          <a-cursor raycaster="objects: .clickable" fuse="false" material="color: white; shader: flat"></a-cursor>
        </a-camera>
      </a-entity>

      <!-- Exterior -->
      <a-plane position="0 -0.1 -50" rotation="-90 0 0" width="150" height="300" color="#333" shadow="receive: true"></a-plane>
      <a-plane position="-20 0 -50" rotation="-90 0 0" width="2" height="200" color="#fff"></a-plane>
      <a-plane position="-35 0 -50" rotation="-90 0 0" width="1" height="200" color="#fff"></a-plane>
      <a-box position="0 -0.05 34" width="20" height="0.1" depth="8" color="#7f8c8d"></a-box>

      <!-- =========================
           TERMINAL (MAIOR)
           ========================= -->

      <!-- Ch√£o maior (antes: height=40). Agora estende at√© aos gates -->
      <a-plane position="0 0 -10" rotation="-90 0 0"
               width="18" height="80"
               src="#chao-tex" repeat="5 18" roughness="0.4"
               shadow="receive: true"></a-plane>

      <!-- Teto maior -->
      <a-box position="0 7 -10" width="20" depth="84" height="0.5" color="#fff" shadow="cast: true"></a-box>

      <!-- Paredes laterais (mais compridas) -->
      <a-box position="-9 3.5 -10" width="0.5" height="7" depth="80"
             color="#aaddff" material="opacity: 0.5; transparent: true"></a-box>
      <a-box position="9 3.5 -10" width="0.5" height="7" depth="80"
             src="#parede-tex" repeat="16 2" shadow="cast: true; receive: true"></a-box>

      <!-- Parede do fundo (mais para tr√°s) -->
      <a-box position="0 3.5 -50" width="18" height="7" depth="0.2"
             color="#aaddff" material="opacity: 0.3; transparent: true"></a-box>

      <!-- Portas entrada -->
      <!-- FACHADA / ENTRADA EM VIDRO (com "porta" ao meio) -->
      <!-- Painel esquerdo -->
      <a-box position="-5.5 3.5 29.906" width="7" height="7" depth="0.2"
            color="#aaddff" material="opacity: 0.5; transparent: true"></a-box>

      <!-- Painel direito -->
      <a-box position="5.5 3.5 29.906" width="7" height="7" depth="0.2"
            color="#aaddff" material="opacity: 0.5; transparent: true"></a-box>

      <!-- Pilar esquerdo da porta -->
      <a-box position="-1.2 3.5 29.906" width="0.25" height="7" depth="0.4" color="#333"></a-box>

      <!-- Pilar direito da porta -->
      <a-box position="1.2 3.5 29.906" width="0.25" height="7" depth="0.4" color="#333"></a-box>

      <!-- Travessa superior da porta (opcional, d√° mais "cara" de entrada) -->
      <a-box position="0 6.95 29.906" width="2.4" height="0.15" depth="0.4" color="#333"></a-box>

      <a-box position="0 5 29.941" width="6" height="0.2" depth="4" color="#333"></a-box>
      <a-text value="ENTRADA" position="-0.222 4.515 31.266" rotation="0 0 0" align="center" color="#fff" width="10"></a-text>

      <!-- Luzes ao longo do terminal -->
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 12"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 0"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 -12"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 -24"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 -36"></a-entity>

      <!-- =========================
           CHECK-IN
           ========================= -->
      <a-entity position="3.7 3.579 20.208" rotation="0 270 0" scale="1 1 1">
        <a-box width="4" height="0.6" depth="0.1" color="#1b4f72"></a-box>
        <a-text value="CHECK-IN" align="center" position="0 0 0.06" width="6" color="#fff"></a-text>
      </a-entity>

      <a-entity gltf-model="#modelo-balcao" position="5.597 0 17.196" scale="0.9 0.9 0.9" rotation="0 180 0" shadow="cast: true"></a-entity>
      <a-entity gltf-model="#modelo-balcao" position="5.597 0 23.292"  scale="0.9 0.9 0.9" rotation="0 180 0" shadow="cast: true"></a-entity>

      <!-- MALA (aparece no check-in; click = pegar/largar) -->
      <a-entity id="luggage" class="clickable"
                position="3 0 20.866" rotation="0 90 0" visible="true">
        <a-entity class="clickable"
                  gltf-model="#modelo-mala"
                  scale="1.5 1.5 1.5"
                  rotation="0 0 0">
        </a-entity>
      </a-entity>

      <!-- MOCHILA (item pessoal para quando escolhe POR√ÉO) -->
      <a-entity id="backpack" class="clickable"
                position="3.35 0 20.866" rotation="0 90 0" visible="false">
        <a-entity class="clickable"
                  gltf-model="#modelo-backpack"
                  scale="1.5 1.5 1.5"
                  rotation="0 0 0">
        </a-entity>
      </a-entity>




      <!-- =========================
     CADEIRAS NA ZONA DO CHECK-IN
     (4 cadeiras, depois ajustas rota√ß√£o/posi√ß√£o)
     ========================= -->
      <a-entity id="checkinChairs" position="2.5 0 22" rotation="0 90 0">
        <a-entity gltf-model="#modelo-cadeira" position="1.832 0 -9.5"   rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="1.832 0 -7.5" rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4.832 0 -9.5"  rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4.832 0 -7.5" rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="-1.168 0 -9.5" rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="-1.168 0 -7.5" rotation="0 0 0" scale="1 1 1"></a-entity>
      </a-entity>


      <a-entity id="gatePanel" position="6.632 1.5 20.215" rotation="0 270 0" scale="1 1 1">
        <a-plane width="2" height="1" color="#111" opacity="0.8"></a-plane>
        <a-text value="Escolhe o Gate" align="center" position="0 0.3 0.01" width="4" color="#fff"></a-text>

        <a-entity class="gateBtn clickable" data-gate="A1" position="-0.6 -0.1 0.02">
          <a-plane class="clickable" width="0.5" height="0.3" color="#fff"></a-plane>
          <a-text value="A1" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
        <a-entity class="gateBtn clickable" data-gate="A2" position="0 -0.1 0.02">
          <a-plane class="clickable" width="0.5" height="0.3" color="#fff"></a-plane>
          <a-text value="A2" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
        <a-entity class="gateBtn clickable" data-gate="A3" position="0.6 -0.1 0.02">
          <a-plane class="clickable" width="0.5" height="0.3" color="#fff"></a-plane>
          <a-text value="A3" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
      </a-entity>

      <!-- PAINEL: Escolher tipo de bagagem -->
      <a-entity id="baggagePanel" position="6.632 0.6 21.0" rotation="0 270 0">
        <a-plane width="2.4" height="1.1" color="#111" opacity="0.85"></a-plane>

        <a-text value="Bagagem" align="center" position="0 0.4 0.01" width="6" color="#fff"></a-text>

        <!-- Mala de M√£o -->
        <a-entity class="bagBtn clickable" data-bag="hand" position="-0.6 -0.05 0.02">
          <a-plane class="clickable" width="1.0" height="0.35" color="#f1c40f"></a-plane>
          <a-text value="M√ÉO" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>

        <!-- Mala de Por√£o -->
        <a-entity class="bagBtn clickable" data-bag="checked" position="0.6 -0.05 0.02">
          <a-plane class="clickable" width="1.0" height="0.35" color="#95a5a6"></a-plane>
          <a-text value="POR√ÉO" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
      </a-entity>


      <!-- =========================
           SECURITY (mantida)
           ========================= -->
        <a-entity position="0 0 1"> <a-box id="securityWall" 
               position="0 2.5 0" 
               width="5.5" height="5" depth="0.1" 
               color="red" 
               material="opacity: 0.3; transparent: true; side: double"
               visible="true">
        </a-box>
        
        <a-text id="securityWallText" value="PARE!\nValide a bagagem." 
                align="center" position="0 3.621 0.1" width="6" color="red"></a-text>

        <a-box position="0 4.618 1.078" width="4" height="0.6" depth="0.1" color="#196f3d"></a-box>
        <a-text value="SECURITY CHECK" align="center" position="0 4.638 1.179" width="6" color="#fff"></a-text>

        <a-entity gltf-model="#modelo-security" position="-2.712 0 0" scale="0.9 0.9 0.9" rotation="0 90 0"></a-entity>
        <a-entity gltf-model="#modelo-security" position="2.712 0 0" scale="0.9 0.9 0.9" rotation="0 270 0"></a-entity>

        <a-entity
          id="scannerSfxEntity"
          position="2.771 1.2 1.625"
          sound="src: #scannerSfx; volume: 0.9; poolSize: 5; positional: true; refDistance: 2; distanceModel: inverse"
        ></a-entity>




        <!-- DROPZONE DO SCANNER (onde tens de largar a mala) -->
        <a-cylinder id="securityDropzone"
                    position="2.771 0.937 1.625"
                    radius="0.8" height="0.05"
                    color="#27ae60"
                    material="opacity: 0.80; transparent: true"
                    shadow="receive: true">
        </a-cylinder>

        <a-text value="DROP BAG HERE" position="2.780 1.270 1.744"
                align="center" width="4" color="#b7f5d1"></a-text>
      </a-entity>

      <!-- =========================
           CORREDOR PARA GATES + SINAL
           ========================= -->
      <a-entity id="gateSign" position="0 3.5 -21.241">
        <a-box width="6" height="0.8" depth="0.12" color="#111"></a-box>
        <a-text id="gateSignText" value="GATES AREA" align="center" position="0 0 0.08" width="8" color="#fff"></a-text>
      </a-entity>

      <!-- =========================
           WAITING AREA (CADEIRAS)
           ========================= -->

      <!-- Tapete/√°rea de espera -->
      <a-plane position="0 0.01 -28" rotation="-90 0 0" width="16" height="14"
               color="#2c3e50" material="opacity: 0.35; transparent: true"></a-plane>

      <!-- Cadeiras em grelha (3 colunas x 4 filas) -->
      <a-entity id="waitingArea" position="0 0 -26">
        <!-- fila 1 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 0"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 0"   rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 0"   rotation="0 180 0" scale="1 1 1"></a-entity>

        <!-- fila 2 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 -3" rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 -3"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 -3"  rotation="0 180 0" scale="1 1 1"></a-entity>

        <!-- fila 3 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 -6" rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 -6"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 -6"  rotation="0 180 0" scale="1 1 1"></a-entity>

        <!-- fila 4 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 -9" rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 -9"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 -9"  rotation="0 180 0" scale="1 1 1"></a-entity>
      </a-entity>

      <!-- =========================
           GATES (mais para tr√°s + placas 3D)
           ========================= -->


      <a-entity position="-4 1.5 -38" rotation="0 45 0">
        <a-text value="PREVIEW: PARIS" align="center" position="0 1.3 0" color="#333" scale="1.5 1.5 1.5"></a-text>
        <a-text value="(Clica para ver o destino)" align="center" position="0 1.1 0" color="#555" scale="0.8 0.8 0.8"></a-text>

        <a-sphere class="clickable" 
                  destination-preview
                  radius="0.6" 
                  color="#3498db" 
                  material="opacity: 0.9; roughness: 0.2; metalness: 0.8"
                  animation="property: position; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true; to: 0 0.1 0">
        </a-sphere>
        
        <a-cylinder radius="0.1" height="1" position="0 -1 0" color="#888"></a-cylinder>
      </a-entity>

      <!-- Gate A1 -->
      <a-entity id="gateA1" position="-6 1 -44">
        <a-box width="2.4" height="2.2" depth="0.12" color="#d8b88f"></a-box>
        <a-text value="GATE A1" position="0 1.35 0.14" align="center" color="#111"></a-text>

        <!-- placa 3D do gate -->
        <a-entity gltf-model="#modelo-gate-sign" position="0 2.8 0.6" rotation="0 0 0" scale="0.25 0.25 0.25"></a-entity>
        <a-text value="A1" position="0 3.35 0.7" align="center" color="#fff" width="6"></a-text>

        <a-cylinder class="gateTarget" data-gate="A1" radius="1.8" height="3" visible="false"></a-cylinder>
      </a-entity>

      <!-- Gate A2 -->
      <a-entity id="gateA2" position="0 1 -44">
        <a-box width="2.4" height="2.2" depth="0.12" color="#d8b88f"></a-box>
        <a-text value="GATE A2" position="0 1.35 0.14" align="center" color="#111"></a-text>

        <a-entity gltf-model="#modelo-gate-sign" position="0 2.8 0.6" rotation="0 0 0" scale="0.25 0.25 0.25"></a-entity>
        <a-text value="A2" position="0 3.35 0.7" align="center" color="#fff" width="6"></a-text>

        <a-cylinder class="gateTarget" data-gate="A2" radius="1.8" height="3" visible="false"></a-cylinder>
      </a-entity>

      <!-- Gate A3 -->
      <a-entity id="gateA3" position="6 1 -44">
        <a-box width="2.4" height="2.2" depth="0.12" color="#d8b88f"></a-box>
        <a-text value="GATE A3" position="0 1.35 0.14" align="center" color="#111"></a-text>

        <a-entity gltf-model="#modelo-gate-sign" position="0 2.8 0.6" rotation="0 0 0" scale="0.25 0.25 0.25"></a-entity>
        <a-text value="A3" position="0 3.35 0.7" align="center" color="#fff" width="6"></a-text>

        <a-cylinder class="gateTarget" data-gate="A3" radius="1.8" height="3" visible="false"></a-cylinder>
      </a-entity>

      <!-- seta come√ßa mais √† frente do corredor -->
      <a-entity id="navArrow" position="0 0.05 -6" visible="false">
        <a-box width="0.4" height="0.05" depth="1.5" color="#e74c3c"></a-box>
        <a-cone position="0 0 -1" radius-bottom="0.3" radius-top="0" height="0.5" rotation="90 0 0" color="#e74c3c"></a-cone>
      </a-entity>

      <a-entity id="targetMarker" visible="false">
        <a-ring radius-inner="0.3" radius-outer="0.4" rotation="90 0 0" color="#e74c3c"></a-ring>
        <a-text value="AQUI" align="center" position="0 0.5 0" color="#e74c3c" face-camera></a-text>
      </a-entity>

    </a-scene>
  </body>
</html>
