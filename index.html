<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aeroporto VR — Wayfinding</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <script>
      AFRAME.registerComponent("face-camera", {
        tick: function () {
          const cam = document.getElementById("cam");
          if (!cam) return;
          const camPos = cam.object3D.getWorldPosition(new THREE.Vector3());
          this.el.object3D.lookAt(camPos);
          this.el.object3D.rotation.x = 0;
          this.el.object3D.rotation.z = 0;
        },
      });

      AFRAME.registerComponent("wayfinding", {
        init: function () {
          this.state = { targetGate: null, reached: false };
          this.el.sceneEl.addEventListener("loaded", () => {
            this.hudTarget = document.getElementById("hudTarget");
            this.nextText = document.getElementById("nextText");
            this.cam = document.getElementById("cam");
            this.navArrow = document.getElementById("navArrow");
            this.marker = document.getElementById("targetMarker");
            this.gateSignText = document.getElementById("gateSignText");
            this.successSound = document.getElementById("soundSuccess");
            this.gates = {
              A1: document.getElementById("gateA1"),
              A2: document.getElementById("gateA2"),
              A3: document.getElementById("gateA3"),
            };
            this.gateTargets = Array.from(document.querySelectorAll(".gateTarget"));
            document.querySelectorAll(".gateBtn").forEach((btn) => {
              btn.addEventListener("click", () => {
                const gate = btn.getAttribute("data-gate");
                this.setTargetGate(gate);
              });
              btn.addEventListener("mouseenter", () =>
                btn.object3D.scale.set(1.06, 1.06, 1.06)
              );
              btn.addEventListener("mouseleave", () =>
                btn.object3D.scale.set(1, 1, 1)
              );
            });
            if (this.nextText)
              this.nextText.setAttribute("value", "NEXT: (seleciona um Gate)");
          });
        },
        setTargetGate: function (gate) {
          this.state.targetGate = gate;
          this.state.reached = false;
          if (this.nextText)
            this.nextText.setAttribute(
              "value",
              `NEXT: Gate ${gate}  →  Segurança  →  Gates`
            );
          if (this.hudTarget)
            this.hudTarget.textContent = `Objetivo: ir para o Gate ${gate}. Segue a sinalética.`;
          if (this.gateSignText)
            this.gateSignText.setAttribute("value", `Gate ${gate}  →`);
          const gateEl = this.gates?.[gate];
          if (!gateEl) return;
          const p = gateEl.object3D.getWorldPosition(new THREE.Vector3());
          if (this.marker) {
            this.marker.setAttribute("position", `${p.x} 2.9 ${p.z}`);
            this.marker.setAttribute("visible", "true");
          }
          if (this.navArrow) {
            const aPos = this.navArrow.object3D.getWorldPosition(new THREE.Vector3());
            const dx = p.x - aPos.x;
            const dz = p.z - aPos.z;
            const yaw = Math.atan2(dx, dz);
            this.navArrow.object3D.rotation.set(0, yaw, 0);
            this.navArrow.setAttribute("visible", "true");
          }
        },
        tick: function () {
          if (!this.state.targetGate || this.state.reached) return;
          if (!this.cam || !this.gateTargets) return;
          const camPos = this.cam.object3D.getWorldPosition(new THREE.Vector3());
          for (const t of this.gateTargets) {
            const gate = t.getAttribute("data-gate");
            if (gate !== this.state.targetGate) continue;
            const tPos = t.object3D.getWorldPosition(new THREE.Vector3());
            const dx = camPos.x - tPos.x;
            const dz = camPos.z - tPos.z;
            const d = Math.sqrt(dx * dx + dz * dz);
            if (d < 2.0) {
              this.state.reached = true;
              if (this.marker) this.marker.setAttribute("visible", "false");
              if (this.navArrow) this.navArrow.setAttribute("visible", "false");
              if (this.hudTarget) this.hudTarget.textContent = `✅ Chegaste ao Gate ${gate}.`;
              if (this.nextText)
                this.nextText.setAttribute("value", "NEXT: (seleciona outro Gate no Check-in)");
              if (this.gateSignText)
                this.gateSignText.setAttribute("value", `✅ Gate ${gate} (chegaste)`);
              if (this.successSound) {
                this.successSound.components.sound.playSound();
              }
            }
          }
        },
      });
    </script>

    <style>
      html, body { margin: 0; height: 100%; overflow: hidden; }
      #hud {
        position: fixed; left: 12px; top: 12px; z-index: 10;
        background: rgba(0,0,0,.6); color: #fff; padding: 10px 12px;
        border-radius: 12px; font-family: system-ui, sans-serif; font-size: 14px;
      }
    </style>
  </head>

  <body>
    <div id="hud">
      <b>Aeroporto VR</b><br />WASD • Rato
      <br/><span id="hudTarget">Entra no aeroporto e faz Check-in.</span>
    </div>

    <a-scene wayfinding renderer="colorManagement: true; physicallyCorrectLights: true;"
             shadow="type: pcfsoft" background="color: #87CEEB">

      <a-assets>
        <img id="chao-tex" src="chao2.jpg">
        <img id="parede-tex" src="parede.jpg">
        <img id="asfalto-tex" src="https://cdn.aframe.io/a-painter/images/floor.jpg">

        <a-asset-item id="modelo-balcao" src="airport_check_in_desk.glb"></a-asset-item>
        <a-asset-item id="modelo-security" src="airport_security_check.glb"></a-asset-item>

        <!-- NOVOS MODELOS -->
        <a-asset-item id="modelo-cadeira" src="waiting_chair.glb"></a-asset-item>
        <a-asset-item id="modelo-gate-sign" src="airport_boarding_gate_sign.glb"></a-asset-item>

        <audio id="airportAmbience" src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_3079b47e40.mp3" preload="auto"></audio>
        <audio id="successClip" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_0625c153e1.mp3" preload="auto"></audio>
      </a-assets>

      <a-entity sound="src: #airportAmbience; autoplay: true; loop: true; volume: 0.5"></a-entity>
      <a-entity id="soundSuccess" sound="src: #successClip; volume: 1.0; poolSize: 5"></a-entity>

      <a-entity light="type: directional; castShadow: true; intensity: 1.5; shadowCameraVisible: false;"
                position="-20 50 -20" target="#directionaltarget">
        <a-entity id="directionaltarget" position="0 0 0"></a-entity>
      </a-entity>
      <a-entity light="type: ambient; intensity: 0.6; color: #fff"></a-entity>

      <a-entity id="player" position="0 0 25">
        <a-camera id="cam" position="0 1.6 0"
                  wasd-controls="acceleration: 50"
                  look-controls="pointerLockEnabled: true; mouseSensitivity: 0.06">
          <a-cursor raycaster="objects: .clickable" fuse="false" material="color: white; shader: flat"></a-cursor>
        </a-camera>
      </a-entity>

      <!-- Exterior -->
      <a-plane position="0 -0.1 -50" rotation="-90 0 0" width="300" height="300" color="#333" shadow="receive: true"></a-plane>
      <a-plane position="-20 0 -50" rotation="-90 0 0" width="2" height="200" color="#fff"></a-plane>
      <a-plane position="-35 0 -50" rotation="-90 0 0" width="1" height="200" color="#fff"></a-plane>
      <a-box position="0 -0.05 34" width="20" height="0.1" depth="8" color="#7f8c8d"></a-box>

      <!-- =========================
           TERMINAL (MAIOR)
           ========================= -->

      <!-- Chão maior (antes: height=40). Agora estende até aos gates -->
      <a-plane position="0 0 -10" rotation="-90 0 0"
               width="18" height="80"
               src="#chao-tex" repeat="5 18" roughness="0.4"
               shadow="receive: true"></a-plane>

      <!-- Teto maior -->
      <a-box position="0 7 -10" width="20" depth="84" height="0.5" color="#fff" shadow="cast: true"></a-box>

      <!-- Paredes laterais (mais compridas) -->
      <a-box position="-9 3.5 -10" width="0.5" height="7" depth="80"
             color="#aaddff" material="opacity: 0.5; transparent: true"></a-box>
      <a-box position="9 3.5 -10" width="0.5" height="7" depth="80"
             src="#parede-tex" repeat="16 2" shadow="cast: true; receive: true"></a-box>

      <!-- Parede do fundo (mais para trás) -->
      <a-box position="0 3.5 -50" width="18" height="7" depth="0.2"
             color="#aaddff" material="opacity: 0.3; transparent: true"></a-box>

      <!-- Portas entrada -->
      <!-- FACHADA / ENTRADA EM VIDRO (com "porta" ao meio) -->
      <!-- Painel esquerdo -->
      <a-box position="-5.5 3.5 29.906" width="7" height="7" depth="0.2"
            color="#aaddff" material="opacity: 0.5; transparent: true"></a-box>

      <!-- Painel direito -->
      <a-box position="5.5 3.5 29.906" width="7" height="7" depth="0.2"
            color="#aaddff" material="opacity: 0.5; transparent: true"></a-box>

      <!-- Pilar esquerdo da porta -->
      <a-box position="-1.2 3.5 29.906" width="0.25" height="7" depth="0.4" color="#333"></a-box>

      <!-- Pilar direito da porta -->
      <a-box position="1.2 3.5 29.906" width="0.25" height="7" depth="0.4" color="#333"></a-box>

      <!-- Travessa superior da porta (opcional, dá mais "cara" de entrada) -->
      <a-box position="0 6.95 29.906" width="2.4" height="0.15" depth="0.4" color="#333"></a-box>

      <a-box position="0 5 29.941" width="6" height="0.2" depth="4" color="#333"></a-box>
      <a-text value="ENTRADA" position="-0.222 4.515 31.266" rotation="0 0 0" align="center" color="#fff" width="10"></a-text>

      <!-- Luzes ao longo do terminal -->
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 12"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 0"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 -12"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 -24"></a-entity>
      <a-entity light="type: point; intensity: 0.55; distance: 18" position="0 6 -36"></a-entity>

      <!-- =========================
           CHECK-IN
           ========================= -->
      <a-entity position="3.7 3.579 20.208" rotation="0 270 0" scale="1 1 1">
        <a-box width="4" height="0.6" depth="0.1" color="#1b4f72"></a-box>
        <a-text value="CHECK-IN" align="center" position="0 0 0.06" width="6" color="#fff"></a-text>
      </a-entity>

      <a-entity gltf-model="#modelo-balcao" position="5.597 0 17.196" scale="0.9 0.9 0.9" rotation="0 180 0" shadow="cast: true"></a-entity>
      <a-entity gltf-model="#modelo-balcao" position="5.597 0 23.292"  scale="0.9 0.9 0.9" rotation="0 180 0" shadow="cast: true"></a-entity>

      <!-- =========================
     CADEIRAS NA ZONA DO CHECK-IN
     (4 cadeiras, depois ajustas rotação/posição)
     ========================= -->
      <a-entity id="checkinChairs" position="2.5 0 22" rotation="0 90 0">
        <a-entity gltf-model="#modelo-cadeira" position="1.832 0 -9.5"   rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="1.832 0 -7.5" rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4.832 0 -9.5"  rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4.832 0 -7.5" rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="-1.168 0 -9.5" rotation="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="-1.168 0 -7.5" rotation="0 0 0" scale="1 1 1"></a-entity>
      </a-entity>


      <a-entity id="gatePanel" position="6.632 1.5 20.215" rotation="0 270 0" scale="1 1 1">
        <a-plane width="2" height="1" color="#111" opacity="0.8"></a-plane>
        <a-text value="Escolhe o Gate" align="center" position="0 0.3 0.01" width="4" color="#fff"></a-text>

        <a-entity class="gateBtn clickable" data-gate="A1" position="-0.6 -0.1 0.02">
          <a-plane class="clickable" width="0.5" height="0.3" color="#fff"></a-plane>
          <a-text value="A1" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
        <a-entity class="gateBtn clickable" data-gate="A2" position="0 -0.1 0.02">
          <a-plane class="clickable" width="0.5" height="0.3" color="#fff"></a-plane>
          <a-text value="A2" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
        <a-entity class="gateBtn clickable" data-gate="A3" position="0.6 -0.1 0.02">
          <a-plane class="clickable" width="0.5" height="0.3" color="#fff"></a-plane>
          <a-text value="A3" align="center" position="0 0 0.01" width="6" color="#111"></a-text>
        </a-entity>
      </a-entity>

      <!-- =========================
           SECURITY (mantida)
           ========================= -->
      <a-entity position="0 2.8 1">
        <a-box width="4" height="0.6" depth="0.1" color="#196f3d"></a-box>
        <a-text value="SECURITY" align="center" position="0 0 0.06" width="6" color="#fff"></a-text>
      </a-entity>
      <a-entity gltf-model="#modelo-security" position="-2.712 0 0" scale="0.9 0.9 0.9" rotation="0 90 0" shadow="cast: true"></a-entity>
      <a-entity gltf-model="#modelo-security" position="2.712 0 0" scale="0.9 0.9 0.9" rotation="0 270 0" shadow="cast: true"></a-entity>

      <!-- =========================
           CORREDOR PARA GATES + SINAL
           ========================= -->
      <a-entity id="gateSign" position="0 3.5 -21.241">
        <a-box width="6" height="0.8" depth="0.12" color="#111"></a-box>
        <a-text id="gateSignText" value="GATES AREA" align="center" position="0 0 0.08" width="8" color="#fff"></a-text>
      </a-entity>

      <!-- =========================
           WAITING AREA (CADEIRAS)
           ========================= -->

      <!-- Tapete/área de espera -->
      <a-plane position="0 0.01 -28" rotation="-90 0 0" width="16" height="14"
               color="#2c3e50" material="opacity: 0.35; transparent: true"></a-plane>

      <!-- Cadeiras em grelha (3 colunas x 4 filas) -->
      <a-entity id="waitingArea" position="0 0 -26">
        <!-- fila 1 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 0"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 0"   rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 0"   rotation="0 180 0" scale="1 1 1"></a-entity>

        <!-- fila 2 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 -3" rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 -3"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 -3"  rotation="0 180 0" scale="1 1 1"></a-entity>

        <!-- fila 3 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 -6" rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 -6"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 -6"  rotation="0 180 0" scale="1 1 1"></a-entity>

        <!-- fila 4 -->
        <a-entity gltf-model="#modelo-cadeira" position="-4 0 -9" rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="0 0 -9"  rotation="0 180 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="#modelo-cadeira" position="4 0 -9"  rotation="0 180 0" scale="1 1 1"></a-entity>
      </a-entity>

      <!-- =========================
           GATES (mais para trás + placas 3D)
           ========================= -->

      <!-- Gate A1 -->
      <a-entity id="gateA1" position="-6 1 -44">
        <a-box width="2.4" height="2.2" depth="0.12" color="#d8b88f"></a-box>
        <a-text value="GATE A1" position="0 1.35 0.14" align="center" color="#111"></a-text>

        <!-- placa 3D do gate -->
        <a-entity gltf-model="#modelo-gate-sign" position="0 2.8 0.6" rotation="0 0 0" scale="0.25 0.25 0.25"></a-entity>
        <a-text value="A1" position="0 3.35 0.7" align="center" color="#fff" width="6"></a-text>

        <a-cylinder class="gateTarget" data-gate="A1" radius="1.8" height="3" visible="false"></a-cylinder>
      </a-entity>

      <!-- Gate A2 -->
      <a-entity id="gateA2" position="0 1 -44">
        <a-box width="2.4" height="2.2" depth="0.12" color="#d8b88f"></a-box>
        <a-text value="GATE A2" position="0 1.35 0.14" align="center" color="#111"></a-text>

        <a-entity gltf-model="#modelo-gate-sign" position="0 2.8 0.6" rotation="0 0 0" scale="0.25 0.25 0.25"></a-entity>
        <a-text value="A2" position="0 3.35 0.7" align="center" color="#fff" width="6"></a-text>

        <a-cylinder class="gateTarget" data-gate="A2" radius="1.8" height="3" visible="false"></a-cylinder>
      </a-entity>

      <!-- Gate A3 -->
      <a-entity id="gateA3" position="6 1 -44">
        <a-box width="2.4" height="2.2" depth="0.12" color="#d8b88f"></a-box>
        <a-text value="GATE A3" position="0 1.35 0.14" align="center" color="#111"></a-text>

        <a-entity gltf-model="#modelo-gate-sign" position="0 2.8 0.6" rotation="0 0 0" scale="0.25 0.25 0.25"></a-entity>
        <a-text value="A3" position="0 3.35 0.7" align="center" color="#fff" width="6"></a-text>

        <a-cylinder class="gateTarget" data-gate="A3" radius="1.8" height="3" visible="false"></a-cylinder>
      </a-entity>

      <!-- =========================
           UI/HELPERS (mantidos)
           ========================= -->
      <a-entity id="nextSign" position="0 2 16" rotation="0 180 0">
        <a-text id="nextText" value="NEXT: Faz Check-in" align="center" color="#111" width="4"></a-text>
      </a-entity>

      <!-- seta começa mais à frente do corredor -->
      <a-entity id="navArrow" position="0 0.05 -6" visible="false">
        <a-box width="0.4" height="0.05" depth="1.5" color="#e74c3c"></a-box>
        <a-cone position="0 0 -1" radius-bottom="0.3" radius-top="0" height="0.5" rotation="90 0 0" color="#e74c3c"></a-cone>
      </a-entity>

      <a-entity id="targetMarker" visible="false">
        <a-ring radius-inner="0.3" radius-outer="0.4" rotation="90 0 0" color="#e74c3c"></a-ring>
        <a-text value="AQUI" align="center" position="0 0.5 0" color="#e74c3c" face-camera></a-text>
      </a-entity>

    </a-scene>
  </body>
</html>
